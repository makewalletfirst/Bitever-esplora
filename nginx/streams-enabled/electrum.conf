upstream electrum_plain {
  # electrs 평문 포트(컨테이너 내부에서 접근되는 주소/포트)
  server 127.0.0.1:50001;
}

# (선택) 평문 테스트용 프록시 서버
# Electrum을 TLS 없이 붙여 프록시/인증서 이슈를 배제하고 점검할 때 사용
server {
  listen 0.0.0.0:50011;         # NGINX가 노출할 테스트 포트 (50001과 겹치면 절대 안 됨)
  proxy_pass electrum_plain;

  # <<< 여기 두 줄이 핵심입니다 >>>
  proxy_timeout 3600s;          # 장기 구독 연결 유지
  proxy_connect_timeout 60s;     # 초기 연결 여유

  # 선택: keepalive 소켓 튜닝
  # proxy_socket_keepalive on;
}

# TLS Electrum (정식 포트)
server {
  listen 0.0.0.0:50002 ssl;

  ssl_certificate     /etc/nginx/certs/fullchain.pem;
  ssl_certificate_key /etc/nginx/certs/privkey.pem;

  proxy_pass electrum_plain;

  # <<< 여기 두 줄이 핵심입니다 >>>
  proxy_timeout 3600s;          # 장기 구독 연결 유지
  proxy_connect_timeout 60s;     # 초기 연결 여유

  # 선택: 조금 더 엄격한 TLS 설정을 원하실 때만 사용
  # ssl_protocols TLSv1.2 TLSv1.3;
  # ssl_prefer_server_ciphers on;
  # ssl_session_cache shared:SSL:10m;
  # ssl_session_timeout  1h;
  # proxy_socket_keepalive on;
}

